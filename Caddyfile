{
    # Configuración del servidor
    auto_https off

    # Configuración de encabezados de seguridad
    header {
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        X-XSS-Protection "1; mode=block"
        Referrer-Policy strict-origin-when-cross-origin
        Permissions-Policy "geolocation=(), microphone=(), camera=()"
    }

    # Configuración de compresión
    encode gzip zstd

    # Manejo de archivos estáticos
    @static {
        path *.css *.js *.png *.jpg *.jpeg *.gif *.ico *.svg *.woff *.woff2 *.ttf *.eot *.json *.xml *.txt *.pdf *.mp4 *.webm *.mp3 *.wav *.ogg *.webp *.avif
    }

    @assets {
        path /assets/*
    }

    # Cache para archivos estáticos
    handle @static @assets {
        header Cache-Control "public, max-age=31536000, immutable"
    }

    # Servir archivos estáticos desde dist
    root * /app/dist

    # Manejar SPA - servir index.html para rutas que no son archivos
    try_files {path} {path}/ /index.html

    # Manejar errores
    handle_errors {
        @404 expression {http.error.status_code} == 404
        handle @404 {
            rewrite * /index.html
            file_server
        }

        @500 expression {http.error.status_code} >= 500
        handle @500 {
            respond "Error del servidor | Server Error" 500
        }
    }

    # Logging
    log {
        output file /var/log/caddy/access.log
        format json
    }
}